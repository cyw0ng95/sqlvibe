# SQL:1999 Feature Requirements

This document tracks SQL:1999 features to implement in sqlvibe. The feature list is derived from **Annex F, Table 31** (SQL/Foundation Feature Taxonomy) of the SQL:1999 standard.

**Target**: SQLite-compatible output, but test suite validates against SQL:1999 Core feature taxonomy.

---

## Reference

- SQL:1999 (ISO/IEC 9075:1999): https://web.cecs.pdx.edu/~len/sql1999.pdf
- SQL-99 Complete, Really: https://sql-99.readthedocs.io/
- Feature Taxonomy: Appendix B - SQL Taxonomy

---

## Core SQL Features (Mandatory)

All features marked as "Core SQL?" = YES are mandatory for SQL:1999 conformance.

### E011: Numeric Data Types

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| E011 | Numeric data types | ✅ Done | INTEGER, SMALLINT, BIGINT, REAL, DOUBLE, FLOAT, DECIMAL, NUMERIC |
| E011-01 | INTEGER and SMALLINT | ✅ Done | Integer literals, expressions, comparison, assignment |
| E011-02 | REAL, DOUBLE PRECISION, FLOAT | ✅ Done | Approximate numeric types |
| E011-03 | DECIMAL and NUMERIC | ✅ Done | Exact numeric with precision/scale |
| E011-04 | Arithmetic operators (+, -, *, /) | ✅ Done | |
| E011-05 | Comparison operators (=, <>, >, >=, <, <=) | ✅ Done | |
| E011-06 | Implicit casting among numeric types | ✅ Done | |

### E021: Character Data Types

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| E021 | Character data types | ⏳ Pending | |
| E021-01 | CHARACTER (CHAR) | ⏳ Pending | Fixed-length strings |
| E021-02 | CHARACTER VARYING (VARCHAR) | ⏳ Pending | Variable-length strings |
| E021-03 | Character literals | ⏳ Pending | String constants |
| E021-04 | CHARACTER_LENGTH function | ⏳ Pending | |
| E021-05 | OCTET_LENGTH function | ⏳ Pending | |
| E021-06 | SUBSTRING function | ⏳ Pending | |
| E021-07 | Character concatenation | ⏳ Pending | |
| E021-08 | UPPER and LOWER functions | ⏳ Pending | |
| E021-09 | TRIM function | ⏳ Pending | |
| E021-10 | Implicit casting among character types | ⏳ Pending | |
| E021-11 | POSITION function | ⏳ Pending | |
| E021-12 | Character comparison | ⏳ Pending | |

### E031: Identifiers

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| E031 | Identifiers | ⏳ Pending | |
| E031-01 | Delimited identifiers | ⏳ Pending | Quoted identifiers |
| E031-02 | Lower case identifiers | ⏳ Pending | Case-insensitive |
| E031-03 | Trailing underscore | ⏳ Pending | |

### E041: Basic Schema Definition

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| E041 | Basic schema definition | ⏳ Pending | |
| E041-01 | Schema definition | ⏳ Pending | CREATE SCHEMA |
| E041-02 | Table definition (base tables) | ⏳ Pending | CREATE TABLE |
| E041-03 | View definition | ⏳ Pending | CREATE VIEW |
| E041-04 | WITH CHECK OPTION | ⏳ Pending | |
| E041-05 | GRANT statement | ⏳ Pending | |
| E041-06 | Optional TABLE keyword in GRANT | ⏳ Pending | |

### E051: Basic Query Specification

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| E051 | Basic query specification | ⏳ Pending | |
| E051-01 | SELECT DISTINCT | ⏳ Pending | |
| E051-02 | GROUP BY clause | ⏳ Pending | |
| E051-03 | GROUP BY need not contain all non-aggregated columns | ⏳ Pending | |
| E051-04 | GROUP BY can contain columns not in select list | ⏳ Pending | |
| E051-05 | Column alias (AS clause) | ⏳ Pending | |
| E051-06 | HAVING clause | ⏳ Pending | |
| E051-07 | Qualified * in select list | ⏳ Pending | table.* |
| E051-08 | Correlation names (table aliases) | ⏳ Pending | |
| E051-09 | Rename columns in FROM clause | ⏳ Pending | |
| E051-10 | Derived tables (subqueries in FROM) | ⏳ Pending | |
| E051-11 | Optional AS before correlation name | ⏳ Pending | |

### E061: Basic Predicates and Search Conditions

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| E061 | Basic predicates and search conditions | ⏳ Pending | |
| E061-01 | Comparison predicate (=, <>, <, >, <=, >=) | ⏳ Pending | |
| E061-02 | BETWEEN predicate | ⏳ Pending | |
| E061-03 | IN predicate | ⏳ Pending | |
| E061-04 | LIKE predicate | ⏳ Pending | |
| E061-05 | LIKE ESCAPE clause | ⏳ Pending | |
| E061-06 | NULL predicate (IS NULL, IS NOT NULL) | ⏳ Pending | |
| E061-07 | Quantified comparison predicate (ALL, ANY) | ⏳ Pending | |
| E061-08 | EXISTS predicate | ⏳ Pending | |
| E061-09 | Subqueries in comparison predicate | ⏳ Pending | Scalar subquery |
| E061-10 | Subqueries in EXISTS predicate | ⏳ Pending | EXISTS subquery |
| E061-11 | Subqueries in IN predicate | ⏳ Pending | IN subquery |
| E061-12 | Subqueries in quantified predicate | ⏳ Pending | |
| E061-13 | Correlated subqueries | ⏳ Pending | |
| E061-14 | Search condition (AND, OR, NOT) | ⏳ Pending | |

### E071: Basic Query Expressions

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| E071 | Basic query expressions | ⏳ Pending | |
| E071-01 | UNION DISTINCT | ⏳ Pending | |
| E071-02 | UNION ALL | ⏳ Pending | |
| E071-03 | EXCEPT DISTINCT | ⏳ Pending | |
| E071-04 | EXCEPT ALL | ⏳ Pending | |
| E071-05 | Columns need not have exactly same type | ⏳ Pending | |
| E071-06 | Table operators in subqueries | ⏳ Pending | |

### E081: Basic Privileges

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| E081 | Basic Privileges | ⏳ Pending | |
| E081-01 | SELECT privilege | ⏳ Pending | |
| E081-02 | DELETE privilege | ⏳ Pending | |
| E081-03 | INSERT privilege (table level) | ⏳ Pending | |
| E081-04 | UPDATE privilege (table level) | ⏳ Pending | |
| E081-05 | UPDATE privilege (column level) | ⏳ Pending | |
| E081-06 | REFERENCES privilege (table level) | ⏳ Pending | |
| E081-07 | REFERENCES privilege (column level) | ⏳ Pending | |
| E081-08 | WITH GRANT OPTION | ⏳ Pending | |

### E091: Set Functions

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| E091 | Set functions | ⏳ Pending | |
| E091-01 | AVG | ⏳ Pending | |
| E091-02 | COUNT | ⏳ Pending | |
| E091-03 | MAX | ⏳ Pending | |
| E091-04 | MIN | ⏳ Pending | |
| E091-05 | SUM | ⏳ Pending | |
| E091-06 | ALL quantifier | ⏳ Pending | |
| E091-07 | DISTINCT quantifier | ⏳ Pending | |

### E101: Basic Data Manipulation

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| E101 | Basic data manipulation | ⏳ Pending | |
| E101-01 | INSERT statement | ⏳ Pending | |
| E101-02 | VALUES clause (multiple rows) | ⏳ Pending | |
| E101-03 | UPDATE (searched) | ⏳ Pending | |
| E101-04 | DELETE (searched) | ⏳ Pending | |

### E111: Single Row Select

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| E111 | Single row SELECT | ⏳ Pending | |

### E121: Basic Cursor Support

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| E121 | Basic cursor support | ⏳ Pending | |
| E121-01 | DECLARE CURSOR | ⏳ Pending | |
| E121-02 | ORDER BY columns not in select list | ⏳ Pending | |
| E121-03 | Value expressions in ORDER BY | ⏳ Pending | |
| E121-04 | OPEN statement | ⏳ Pending | |
| E121-05 | FETCH statement | ⏳ Pending | |
| E121-06 | UPDATE (positioned) | ⏳ Pending | |
| E121-07 | DELETE (positioned) | ⏳ Pending | |
| E121-08 | CLOSE statement | ⏳ Pending | |
| E121-10 | FETCH with implicit NEXT | ⏳ Pending | |

### E131: Null Value Support

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| E131 | Null value support | ⏳ Pending | NULLs in lieu of values |

### E141: Basic Integrity Constraints

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| E141 | Basic integrity constraints | ⏳ Pending | |
| E141-01 | NOT NULL constraints | ⏳ Pending | |
| E141-02 | UNIQUE constraints of NOT NULL columns | ⏳ Pending | |
| E141-03 | PRIMARY KEY constraints | ⏳ Pending | |
| E141-04 | FOREIGN KEY with NO ACTION default | ⏳ Pending | |
| E141-06 | CHECK constraints | ⏳ Pending | |
| E141-07 | Column defaults | ⏳ Pending | |
| E141-08 | NOT NULL inferred on PRIMARY KEY | ⏳ Pending | |

### E151: Transaction Support

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| E151 | Transaction support | ⏳ Pending | |
| E151-01 | COMMIT statement | ⏳ Pending | |
| E151-02 | ROLLBACK statement | ⏳ Pending | |

### E152: SET TRANSACTION

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| E152 | Basic SET TRANSACTION | ⏳ Pending | |
| E152-01 | SET TRANSACTION: ISOLATION LEVEL | ⏳ Pending | SERIALIZABLE only |
| E152-02 | SET TRANSACTION: READ ONLY/WRITE | ⏳ Pending | |

### E153: Updatable Queries with Subqueries

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| E153 | Updatable queries with subqueries | ⏳ Pending | |

### E161: SQL Comments

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| E161 | SQL comments using double minus | ⏳ Pending | -- comment |

### E171: SQLSTATE

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| E171 | SQLSTATE support | ⏳ Pending | Error codes |

---

## Additional Core Features (Fxxx)

### F021: Information Schema

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| F021 | Basic information schema | ⏳ Pending | |
| F021-01 | COLUMNS view | ⏳ Pending | |
| F021-02 | TABLES view | ⏳ Pending | |
| F021-03 | VIEWS view | ⏳ Pending | |
| F021-04 | TABLE_CONSTRAINTS view | ⏳ Pending | |
| F021-05 | REFERENTIAL_CONSTRAINTS view | ⏳ Pending | |

### F031: Schema Manipulation

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| F031 | Basic schema manipulation | ⏳ Pending | |
| F031-01 | CREATE TABLE | ⏳ Pending | |
| F031-02 | CREATE VIEW | ⏳ Pending | |
| F031-03 | GRANT statement | ⏳ Pending | |
| F031-04 | ALTER TABLE: ADD COLUMN | ⏳ Pending | |
| F031-13 | DROP TABLE: RESTRICT | ⏳ Pending | |
| F031-16 | DROP VIEW: RESTRICT | ⏳ Pending | |

### F041: Joined Tables

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| F041 | Basic joined tables | ⏳ Pending | |
| F041-01 | Inner join | ⏳ Pending | |
| F041-02 | INNER keyword | ⏳ Pending | |
| F041-03 | LEFT OUTER JOIN | ⏳ Pending | |
| F041-04 | RIGHT OUTER JOIN | ⏳ Pending | |
| F041-05 | Outer joins can be nested | ⏳ Pending | |
| F041-07 | Inner table in outer join can be used in inner join | ⏳ Pending | |
| F041-08 | All comparison operators in joins | ⏳ Pending | |

### F051: Date and Time

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| F051 | Basic date and time | ⏳ Pending | |
| F051-01 | DATE data type | ⏳ Pending | |
| F051-02 | TIME data type | ⏳ Pending | |
| F051-03 | TIMESTAMP data type | ⏳ Pending | |
| F051-04 | Comparison on date/time types | ⏳ Pending | |
| F051-05 | CAST between datetime and character | ⏳ Pending | |
| F051-06 | CURRENT_DATE | ⏳ Pending | |
| F051-07 | LOCALTIME | ⏳ Pending | |
| F051-08 | LOCALTIMESTAMP | ⏳ Pending | |

### F131: Grouped Operations

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| F131 | Grouped operations | ⏳ Pending | |
| F131-01 | WHERE, GROUP BY, HAVING in grouped queries | ⏳ Pending | |
| F131-02 | Multiple tables in grouped queries | ⏳ Pending | |
| F131-03 | Set functions in grouped queries | ⏳ Pending | |
| F131-04 | Subqueries with GROUP BY/HAVING | ⏳ Pending | |

### F201: CAST Function

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| F201 | CAST function | ⏳ Pending | |

### F221: Explicit Defaults

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| F221 | Explicit defaults | ⏳ Pending | DEFAULT clause |

### F261: CASE Expression

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| F261 | CASE expression | ⏳ Pending | |
| F261-01 | Simple CASE | ⏳ Pending | |
| F261-02 | Searched CASE | ⏳ Pending | |
| F261-03 | NULLIF function | ⏳ Pending | |
| F261-04 | COALESCE function | ⏳ Pending | |

### F311: Schema Definition Statement

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| F311 | Schema definition statement | ⏳ Pending | |
| F311-01 | CREATE SCHEMA | ⏳ Pending | |
| F311-02 | CREATE TABLE | ⏳ Pending | |
| F311-03 | CREATE VIEW | ⏳ Pending | |
| F311-04 | CREATE VIEW: WITH CHECK OPTION | ⏳ Pending | |
| F311-05 | GRANT statement | ⏳ Pending | |

### F471: Scalar Subquery Values

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| F471 | Scalar subquery values | ⏳ Pending | (SELECT ...) in expressions |

### F481: Expanded NULL Predicate

| Feature ID | Feature Description | Status | Notes |
|------------|-------------------|--------|-------|
| F481 | Expanded NULL predicate | ⏳ Pending | IS NULL / IS NOT NULL |

---

## Implementation Priority

### Phase 1: Core Query Operations (v0.1.x - v0.3.x)

- [x] E011: Numeric data types (COMPLETE)

### Phase 2: Advanced Query Operations (v0.4.x)

- [ ] E021: Character data types (all sections)
- [ ] E031: Identifiers
- [ ] E041: Schema definition
- [ ] E051: Basic query specification
- [ ] E061: Predicates and search conditions
- [ ] E071: Set operations (UNION, EXCEPT, INTERSECT)
- [ ] E081: Privileges
- [ ] E091: Set functions
- [ ] E101: Data manipulation
- [ ] E111: Single row select
- [ ] E121: Cursor support
- [ ] E131: Null value support
- [ ] E141: Integrity constraints
- [ ] E151: Transaction support
- [ ] E152: SET TRANSACTION
- [ ] E153: Updatable queries
- [ ] E161: SQL comments
- [ ] E171: SQLSTATE
- [ ] F021: Information schema
- [ ] F031: Schema manipulation
- [ ] F041: JOINs
- [ ] F051: Date and time
- [ ] F131: Grouped operations
- [ ] F201: CAST function
- [ ] F221: Explicit defaults
- [ ] F261: CASE expression
- [ ] F311: Schema definition
- [ ] F471: Scalar subquery values
- [ ] F481: Expanded NULL predicate

---

## Test Commands

```bash
# Run all SQL:1999 feature tests
go test -run TestSQL1999 ./pkg/sqlvibe

# Run tests by feature category
go test -run TestCh3 ./pkg/sqlvibe    # E011: Numbers
go test -run TestCh18 ./pkg/sqlvibe   # E041: Tables
go test -run TestCh20 ./pkg/sqlvibe   # E141: Constraints
go test -run TestCh28 ./pkg/sqlvibe   # E051: SELECT
go test -run TestCh29 ./pkg/sqlvibe   # E061: Search Conditions
go test -run TestCh30 ./pkg/sqlvibe   # F041: JOINs
go test -run TestCh31 ./pkg/sqlvibe   # E061: Subqueries
go test -run TestCh32 ./pkg/sqlvibe   # E071: Set Operators
go test -run TestCh33 ./pkg/sqlvibe   # E091: Aggregates
go test -run TestCh34 ./pkg/sqlvibe   # E121: ORDER BY
go test -run TestCh35 ./pkg/sqlvibe   # E101: DML
go test -run TestCh36 ./pkg/sqlvibe   # E151: Transactions

# Run specific feature tests
go test -run TestQueryJoins ./pkg/sqlvibe
go test -run TestQuerySubqueries ./pkg/sqlvibe
go test -run TestQueryWhereClauses ./pkg/sqlvibe
```

---

## Test File Organization

Test files are organized under `internal/TS/SQL1999/<FeatureID>/` directories (e.g., `internal/TS/SQL1999/E011/`).

### File Naming Convention

- **Pattern**: `<Level>_test.go` (e.g., `01_test.go`, `02_test.go`, `03_test.go`)
- **NOT**: `<FeatureID>-<Level>.go` (e.g., `E011-01.go`) or `<Level>.go` (missing _test)
- Each file contains tests for a specific feature level

### Test Function Naming Convention

- **Pattern**: `Test<Testsuite>_F<Feature>_<Name>_L<Level>`
- Example: `TestSQL1999_F301_E01101_L1` for E011-01 level 1

### Helper Functions

Shared test helpers are in `internal/TS/SQL1999/helpers.go`:
- `sqlvibeDB()` - create sqlvibe database connection
- `sqliteDB()` - create SQLite connection  
- `FetchAllRows()` - fetch rows from sqlvibe result
- `FetchAllRowsSQLite()` - fetch rows from SQLite result
- `CompareQueryResults()` - compare query results between sqlvibe and SQLite
- `CompareExecResults()` - compare execution results

- SQLite compatibility is the primary target, but tests validate SQL:1999 Core compliance
- Features marked ⏳ Pending should be implemented based on the priority list above
- Each implementation should include corresponding test cases in `pkg/sqlvibe/`
- Use comparison tests against SQLite to verify correctness
