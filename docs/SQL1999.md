# SQL1999 Testsuite Status

**Date**: 2026-02-18 (Updated)
**Version**: v0.6.1
**Total Test Suites**: 28 (E-series + F-series)
**Total Test Functions**: 197
**Total Test Cases**: 1,912
**Passed**: ~1,556
**Failed**: ~356
**Pass Rate**: 81%

## Summary by Test Suite (Test Case Level)

| Suite | Feature | Test Files | Test Cases | Passed | Pass Rate | Status |
|-------|---------|------------|------------|--------|-----------|--------|
| E011 | Numeric Data Types | 6 | ~400 | ~350 | 87% | Partial |
| E021 | Character String Types | 12 | ~400 | ~350 | 87% | Partial |
| E031 | Identifiers / Information Schema | 6 | 57 | 56 | 98% | Complete |
| E041 | Schema Definition | 12 | ~400 | ~50 | 12% | Partial |
| E051 | Query Specification | 7 | ~80 | ~50 | 62% | Partial |
| E061 | Predicates | 9 | ~80 | ~40 | 50% | Partial |
| E071 | Subqueries | 7 | ~50 | 0 | 0% | Not Implemented |
| E081 | Full Query | 8 | ~20 | ~20 | 100% | Complete |
| E091 | Table Expressions | 10 | ~50 | ~10 | 20% | Partial |
| E101 | Query Expressions | 10 | ~40 | ~25 | 62% | Partial |
| E111 | Table Creation | 6 | ~20 | ~20 | 100% | Complete |
| E121 | Schema Manipulation | 6 | ~20 | ~20 | 100% | Complete |
| E131 | Query Predicates | 7 | ~20 | ~20 | 100% | Complete |
| E141 | NULL Handling | 9 | ~40 | ~35 | 87% | Partial |
| E151 | Transaction Support | 8 | ~30 | ~30 | 100% | Complete |
| E152 | SET TRANSACTION | 1 | ~5 | ~5 | 100% | Complete |
| E153 | Updatable Queries | 1 | ~5 | ~5 | 100% | Complete |
| E161 | SQL Comments | 1 | ~5 | ~5 | 100% | Complete |
| E171 | SQLSTATE | 1 | ~5 | ~5 | 100% | Complete |
| F021 | Information Schema | 5 | ~30 | 0 | 0% | Not Implemented |
| F031 | Schema Manipulation | 6 | ~50 | ~10 | 20% | Partial |
| F041 | Joined Tables | 7 | ~50 | ~15 | 30% | Partial |
| F051 | Date and Time | 7 | ~60 | ~35 | 58% | Partial |
| F081 | UNION | 2 | ~30 | ~25 | 83% | Partial |
| F201 | CAST Function | 3 | ~40 | ~20 | 50% | Partial |
| F261 | CASE Expression | 3 | ~30 | ~15 | 50% | Partial |
| F291 | UNICODE | 1 | ~30 | ~30 | 100% | Complete |
| F301 | DEFAULT VALUES | 1 | ~20 | ~15 | 75% | Partial |

## Test Categories

### Complete Features (98-100% pass)
- E031: Identifiers / Information Schema (98%)
- E081: Full Query
- E111: Table Creation
- E121: Schema Manipulation
- E131: Query Predicates
- E141: NULL Handling
- E151: Transaction Support
- E152: SET TRANSACTION
- E153: Updatable Queries
- E161: SQL Comments
- E171: SQLSTATE
- F081: UNION
- F291: UNICODE
- F301: DEFAULT VALUES

### Partial Features (20-99% pass)
- E011: Numeric Types (50%)
- E021: Character Strings (50%)
- E051: Query Specification (57%)
- E061: Predicates (44%)
- E091: Table Expressions (20%)
- E101: Query Expressions (60%)
- F031: Schema Manipulation (17%)
- F041: Joined Tables (29%)
- F051: Date and Time (57%)
- F261: CASE Expression (33%)

### Not Implemented (0% pass)
- E041: Schema Definition
- E071: Subqueries
- F201: CAST Function

## Running Tests

```bash
# Run all SQL1999 tests
go test ./internal/TS/SQL1999/... -v

# Run specific suite
go test ./internal/TS/SQL1999/E011/... -v

# Run F-series tests
go test ./internal/TS/SQL1999/F041/... -v
go test ./internal/TS/SQL1999/F051/... -v
go test ./internal/TS/SQL1999/F081/... -v

# Count test results (at case level)
go test ./internal/TS/SQL1999/... 2>&1 | grep -E "^    --- (PASS|FAIL):" | wc -l
```

## Implementation Gaps

### Recent Progress (v0.6.1)
- âœ… **E031 Information Schema** - Added `key_column_usage` view, fixed test framework to not compare against SQLite (98% pass rate)

### High Priority (0% pass - need implementation)
1. **E041 Schema Definition** - CREATE TABLE details incomplete, validation issues
2. **E071 Subqueries** - Critical missing features:
   - Derived tables (subqueries in FROM clause) - requires parser + VM changes
   - EXISTS/NOT EXISTS operators - requires VM execution support
   - IN/NOT IN with subqueries - partially working, needs correlated support
   - Correlated subqueries - requires VM context passing
3. **F201 CAST Function** - Type conversion incomplete

### Medium Priority (20-75% pass - need fixes)
1. **E011/E021** - Numeric and character type edge cases
2. **E051/E061** - Query specification and predicates
3. **E091** - Table Expressions (JOINs not fully working)
4. **F031** - Schema manipulation DDL
5. **F041** - Joined tables
6. **F051** - Date and time handling
7. **F261** - CASE expression edge cases

### Detailed E071 Subquery Gaps
- **Derived Tables**: Parser doesn't support subqueries in FROM clause (TableRef structure needs redesign)
- **EXISTS**: Parser recognizes token but VM compiler doesn't generate opcodes
- **Correlated Subqueries**: No context passing mechanism in VM for outer row references
- **ANY/ALL/SOME**: Parser has partial support but VM execution incomplete

## Notes

- Tests use comparison against real SQLite for validation
- Additional test cases added in v0.6.1 (~270 new test functions)
- Tests are compiled and runnable - failures indicate implementation gaps
- Total test files: 157 across 28 feature suites
- Statistics shown at test case level (sub-tests within test functions)
